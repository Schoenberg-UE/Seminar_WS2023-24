(self.webpackChunkschoenberg_letters=self.webpackChunkschoenberg_letters||[]).push([[501],{69199:function(t,e,n){var r=n(89881),o=n(98612);t.exports=function(t,e){var n=-1,i=o(t)?Array(t.length):[];return r(t,(function(t,r,o){i[++n]=e(t,r,o)})),i}},82689:function(t,e,n){var r=n(29932),o=n(97786),i=n(67206),a=n(69199),s=n(71131),c=n(7518),l=n(85022),u=n(6557),f=n(1469);t.exports=function(t,e,n){e=e.length?r(e,(function(t){return f(t)?function(e){return o(e,1===t.length?t[0]:t)}:t})):[u];var d=-1;e=r(e,c(i));var v=a(t,(function(t,n,o){return{criteria:r(e,(function(e){return e(t)})),index:++d,value:t}}));return s(v,(function(t,e){return l(t,e,n)}))}},71131:function(t){t.exports=function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}},36128:function(t,e,n){var r=n(20731),o=n(21078),i=n(45652);t.exports=function(t,e,n){var a=t.length;if(a<2)return a?i(t[0]):[];for(var s=-1,c=Array(a);++s<a;)for(var l=t[s],u=-1;++u<a;)u!=s&&(c[s]=r(c[s]||l,t[u],e,n));return i(o(c,1),e,n)}},26393:function(t,e,n){var r=n(33448);t.exports=function(t,e){if(t!==e){var n=void 0!==t,o=null===t,i=t==t,a=r(t),s=void 0!==e,c=null===e,l=e==e,u=r(e);if(!c&&!u&&!a&&t>e||a&&s&&l&&!c&&!u||o&&s&&l||!n&&l||!i)return 1;if(!o&&!a&&!u&&t<e||u&&n&&i&&!o&&!a||c&&n&&i||!s&&i||!l)return-1}return 0}},85022:function(t,e,n){var r=n(26393);t.exports=function(t,e,n){for(var o=-1,i=t.criteria,a=e.criteria,s=i.length,c=n.length;++o<s;){var l=r(i[o],a[o]);if(l)return o>=c?l:l*("desc"==n[o]?-1:1)}return t.index-e.index}},16612:function(t,e,n){var r=n(77813),o=n(98612),i=n(65776),a=n(13218);t.exports=function(t,e,n){if(!a(n))return!1;var s=typeof e;return!!("number"==s?o(n)&&i(e,n.length):"string"==s&&e in n)&&r(n[e],t)}},89734:function(t,e,n){var r=n(21078),o=n(82689),i=n(5976),a=n(16612),s=i((function(t,e){if(null==t)return[];var n=e.length;return n>1&&a(t,e[0],e[1])?e=[]:n>2&&a(e[0],e[1],e[2])&&(e=[e[0]]),o(t,r(e,1),[])}));t.exports=s},76566:function(t,e,n){var r=n(34963),o=n(5976),i=n(36128),a=n(29246),s=o((function(t){return i(r(t,a))}));t.exports=s},26501:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return It}});var r=n(37272),o=n(80428),i=n(91072),a=n(85564),s=n.n(a),c=n(11196),l=n(67294),u=n(90948),f=n(23279),d=n.n(f),v=n(18446),h=n.n(v),p=n(69203),g=n.n(p),y=n(93967),w=n.n(y),m=n(81720),b=n(73935),A=n(89734),O=n.n(A),x=n(76566),I=n.n(x);function j(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,C(r.key),r)}}function C(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var k=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.viewer=e,this.ref=n,this.containerWidth=0,this.containerHeight=0,this.imgAspectRatio=1}var e,n,r;return e=t,(n=[{key:"canvas",get:function(){return this.canvasDiv.firstElementChild}},{key:"canvasDiv",get:function(){return this.ref.current}},{key:"context2d",get:function(){return this.canvas.getContext("2d")}},{key:"clear",value:function(){this.context2d.clearRect(0,0,this.containerWidth,this.containerHeight)}},{key:"resize",value:function(){this.containerWidth!==this.viewer.container.clientWidth&&(this.containerWidth=this.viewer.container.clientWidth,this.canvasDiv.setAttribute("width",this.containerWidth),this.canvas.setAttribute("width",this.containerWidth)),this.containerHeight!==this.viewer.container.clientHeight&&(this.containerHeight=this.viewer.container.clientHeight,this.canvasDiv.setAttribute("height",this.containerHeight),this.canvas.setAttribute("height",this.containerHeight)),this.viewportOrigin=new(g().Point)(0,0);var t=this.viewer.viewport.getBoundsNoRotateWithMargins(!0);this.viewportOrigin.x=t.x,this.viewportOrigin.y=t.y*this.imgAspectRatio,this.viewportWidth=t.width,this.viewportHeight=t.height*this.imgAspectRatio;var e=this.viewer.world.getItemAt(0);e&&(this.imgWidth=e.source.dimensions.x,this.imgHeight=e.source.dimensions.y,this.imgAspectRatio=this.imgWidth/this.imgHeight)}},{key:"canvasUpdate",value:function(t){var e=this.viewer.viewport.getZoom(!0),n=this.viewer.world.getItemAt(0);if(n){var r=n.viewportToImageZoom(e),o=(this.viewportOrigin.x/this.imgWidth-this.viewportOrigin.x)/this.viewportWidth*this.containerWidth,i=(this.viewportOrigin.y/this.imgHeight-this.viewportOrigin.y)/this.viewportHeight*this.containerHeight;this.clearBeforeRedraw&&this.clear(),this.context2d.translate(o,i),this.context2d.scale(r,r);var a=this.viewer.viewport.getCenter();this.viewer.viewport.getFlip()&&(this.context2d.translate(2*a.x,0),this.context2d.scale(-1,1));var s=this.viewer.viewport.getRotation();0!==s&&(this.context2d.translate(a.x,a.y),this.context2d.rotate(s*Math.PI/180),this.context2d.translate(-1*a.x,-1*a.y)),t(),this.context2d.setTransform(1,0,0,1,0,0)}}}])&&j(e.prototype,n),r&&j(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function P(t){return function(t){if(Array.isArray(t))return S(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return S(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function T(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,R(r.key),r)}}function R(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var M=function(){function t(e){var n=e.resource,r=e.palette,o=e.zoomRatio,i=e.offset,a=e.selected,s=e.hovered;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.resource=n,this.palette=r,this.zoomRatio=o,this.offset=i,this.selected=a,this.hovered=s}var e,n,r;return e=t,(n=[{key:"toContext",value:function(t){this.context=t,this.resource.svgSelector?this.svgContext():this.resource.fragmentSelector&&this.fragmentContext()}},{key:"svgString",get:function(){return this.resource.svgSelector.value}},{key:"svgContext",value:function(){var t,e=this;0!==(t=this.hovered?this.palette.hovered:this.selected?this.palette.selected:this.palette.default).globalAlpha&&P(this.svgPaths).forEach((function(n){e.context.save(),e.context.translate(e.offset.x,e.offset.y);var r=new Path2D(n.attributes.d.nodeValue);e.context.strokeStyle=e.color,n.attributes["stroke-dasharray"]&&e.context.setLineDash(n.attributes["stroke-dasharray"].nodeValue.split(","));var o={fill:"fillStyle",stroke:"strokeStyle","stroke-dashoffset":"lineDashOffset","stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-miterlimit":"miterlimit","stroke-width":"lineWidth"};Object.keys(o).forEach((function(t){n.attributes[t]&&(e.context[o[t]]=n.attributes[t].nodeValue)})),e.context.lineWidth/=e.zoomRatio,(e.selected||e.hovered)&&(e.context.strokeStyle=t.strokeStyle||t.fillStyle),n.attributes["stroke-opacity"]?e.context.globalAlpha=t.globalAlpha*n.attributes["stroke-opacity"].nodeValue:e.context.globalAlpha=t.globalAlpha,e.context.stroke(r),n.attributes.fill&&"none"!==n.attributes.fill.nodeValue&&(n.attributes["fill-opacity"]?e.context.globalAlpha=t.globalAlpha*n.attributes["fill-opacity"].nodeValue:e.context.globalAlpha=t.globalAlpha,e.context.fill(r)),e.context.restore()}))}},{key:"fragmentContext",value:function(){var t,e,n,r=this,o=this.resource.fragmentSelector;(o[0]+=this.offset.x,o[1]+=this.offset.y,t=this.selected?this.palette.selected:this.hovered?this.palette.hovered:this.palette.default,this.context.save(),Object.keys(t).forEach((function(e){r.context[e]=t[e]})),0!==t.globalAlpha)&&(t.fillStyle?(e=this.context).fillRect.apply(e,P(o)):(this.context.lineWidth=1/this.zoomRatio,(n=this.context).strokeRect.apply(n,P(o))),this.context.restore())}},{key:"svgPaths",get:function(){return(new DOMParser).parseFromString(this.svgString,"text/xml").getElementsByTagName("path")}}])&&T(e.prototype,n),r&&T(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),W=n(85893);function E(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function H(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?E(Object(n),!0).forEach((function(e){D(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function D(t,e,n){return(e=F(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function z(t){return function(t){if(Array.isArray(t))return _(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||U(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function V(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,l=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return s}}(t,e)||U(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function U(t,e){if(t){if("string"==typeof t)return _(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(t,e):void 0}}function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function B(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,F(r.key),r)}}function F(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}function N(t,e,n){return e=$(e),function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return J(t)}(t,Z()?Reflect.construct(e,n||[],$(t).constructor):e.apply(t,n))}function Z(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Z=function(){return!!t})()}function $(t){return $=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},$(t)}function J(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function X(t,e){return X=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},X(t,e)}var q=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=N(this,e,[t])).ref=(0,l.createRef)(),n.osdCanvasOverlay=null,n.updateCanvas=function(){},n.onUpdateViewport=n.onUpdateViewport.bind(J(n)),n.onCanvasClick=n.onCanvasClick.bind(J(n)),n.onCanvasMouseMove=d()(n.onCanvasMouseMove.bind(J(n)),10),n.onCanvasExit=n.onCanvasExit.bind(J(n)),n}var n,r,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&X(t,e)}(e,t),n=e,r=[{key:"componentDidMount",value:function(){this.initializeViewer()}},{key:"componentDidUpdate",value:function(t){var n=this.props,r=n.drawAnnotations,o=n.drawSearchAnnotations,i=n.annotations,a=n.searchAnnotations,s=n.hoveredAnnotationIds,c=n.selectedAnnotationId,l=n.highlightAllAnnotations,u=n.viewer;this.initializeViewer();var f=!e.annotationsMatch(i,t.annotations),d=!e.annotationsMatch(a,t.searchAnnotations),v=I()(s,t.hoveredAnnotationIds).length>0;this.osdCanvasOverlay&&v&&(s.length>0?this.osdCanvasOverlay.canvasDiv.style.cursor="pointer":this.osdCanvasOverlay.canvasDiv.style.cursor="");var h=c!==t.selectedAnnotationId,p=r!==t.drawAnnotations||o!==t.drawSearchAnnotations||l!==t.highlightAllAnnotations;(d||f||h||v||p)&&(this.updateCanvas=this.canvasUpdateCallback(),u.forceRedraw())}},{key:"componentWillUnmount",value:function(){var t=this.props.viewer;this.onCanvasMouseMove.cancel(),t.removeHandler("canvas-click",this.onCanvasClick),t.removeHandler("canvas-exit",this.onCanvasExit),t.removeHandler("update-viewport",this.onUpdateViewport),t.removeHandler("mouse-move",this.onCanvasMouseMove)}},{key:"onCanvasClick",value:function(t){var e=this,n=this.props.canvasWorld,r=t.position,o=t.eventSource.viewport.pointFromPixel(r),i=n.canvasAtPoint(o);if(i){var a=V(n.canvasToWorldCoordinates(i.id),4),s=(a[0],a[1],a[2]),c=a[3],l=this.annotationsAtPoint(i,o);if(l.length>0&&(t.preventDefaultAction=!0),1===l.length)this.toggleAnnotation(l[0].id);else if(l.length>0){var u=function(t){var n=Math.PI/180;return function(r){for(var a=0,s=0;s<360;s+=1){var c=Math.cos(s*n)*t+o.x,l=Math.sin(s*n)*t+o.y;e.isAnnotationAtPoint(r,i,{x:c,y:l})&&(a+=1)}return{anno:r,score:a}}},f=[],d=1;for(f=O()(l.map(u(d)),"score");d<Math.max(s,c)&&f[0].score===f[1].score;)d*=2,f=O()(l.map(u(d)),"score");this.toggleAnnotation(f[0].anno.id)}}}},{key:"onCanvasMouseMove",value:function(t){var e=this.props,n=e.annotations,r=e.canvasWorld,o=e.hoverAnnotation,i=e.hoveredAnnotationIds,a=e.searchAnnotations,s=e.viewer,c=e.windowId;if(0!==n.length||0!==a.length){var l=t.position,u=s.viewport.pointFromPixel(l),f=r.canvasAtPoint(u);if(f){var d=this.annotationsAtPoint(f,u);I()(i,d.map((function(t){return t.id}))).length>0&&o(c,d.map((function(t){return t.id})))}else o(c,[])}}},{key:"onCanvasExit",value:function(t){var e=this.props,n=e.hoverAnnotation,r=e.windowId;this.onCanvasMouseMove.cancel(),n(r,[])}},{key:"onUpdateViewport",value:function(t){this.updateCanvas()}},{key:"initializeViewer",value:function(){var t=this.props.viewer;t&&(this.osdCanvasOverlay||(this.osdCanvasOverlay=new k(t,this.ref),t.addHandler("canvas-click",this.onCanvasClick),t.addHandler("canvas-exit",this.onCanvasExit),t.addHandler("update-viewport",this.onUpdateViewport),t.addHandler("mouse-move",this.onCanvasMouseMove),this.updateCanvas=this.canvasUpdateCallback()))}},{key:"canvasUpdateCallback",value:function(){var t=this;return function(){t.osdCanvasOverlay.clear(),t.osdCanvasOverlay.resize(),t.osdCanvasOverlay.canvasUpdate(t.renderAnnotations.bind(t))}}},{key:"isAnnotationAtPoint",value:function(t,e,n){var r=V(this.props.canvasWorld.canvasToWorldCoordinates(e.id),2),o=r[0],i=r[1],a=n.x-o,s=n.y-i;if(t.svgSelector){var c=this.osdCanvasOverlay.context2d;return z(new M({resource:t}).svgPaths).some((function(t){return c.isPointInPath(new Path2D(t.attributes.d.nodeValue),a,s)}))}if(t.fragmentSelector){var l=V(t.fragmentSelector,4),u=l[0],f=l[1],d=l[2],v=l[3];return u<=a&&a<=u+d&&f<=s&&s<=f+v}return!1}},{key:"annotationsAtPoint",value:function(t,e){var n=this,r=this.props,o=r.annotations,i=r.searchAnnotations,a=[].concat(z(o),z(i));return s()(a.map((function(t){return t.resources}))).filter((function(r){return t.id===r.targetId&&n.isAnnotationAtPoint(r,t,e)}))}},{key:"toggleAnnotation",value:function(t){var e=this.props,n=e.selectedAnnotationId,r=e.selectAnnotation,o=e.deselectAnnotation,i=e.windowId;n===t?o(i,t):r(i,t)}},{key:"annotationsToContext",value:function(t,e){var n=this.props,r=n.highlightAllAnnotations,o=n.hoveredAnnotationIds,i=n.selectedAnnotationId,a=n.canvasWorld,s=n.viewer,c=this.osdCanvasOverlay.context2d,l=s.viewport.getZoom(!0)/s.viewport.getMaxZoom();t.forEach((function(t){t.resources.forEach((function(t){if(a.canvasIds.includes(t.targetId)){var n=a.offsetByCanvas(t.targetId);new M({hovered:o.includes(t.id),offset:n,palette:H(H({},e),{},{default:H(H({},e.default),!r&&e.hidden)}),resource:t,selected:i===t.id,zoomRatio:l}).toContext(c)}}))}))}},{key:"renderAnnotations",value:function(){var t=this.props,e=t.annotations,n=t.drawAnnotations,r=t.drawSearchAnnotations,o=t.searchAnnotations,i=t.palette;r&&this.annotationsToContext(o,i.search),n&&this.annotationsToContext(e,i.annotations)}},{key:"render",value:function(){var t=this.props.viewer;return t?b.createPortal((0,W.jsx)("div",{ref:this.ref,style:{height:"100%",left:0,position:"absolute",top:0,width:"100%"},children:(0,W.jsx)("canvas",{})}),t.canvas):null}}],o=[{key:"annotationsMatch",value:function(t,e){return!t&&!e||!(t&&!e||!t&&e)&&(0===t.length&&0===e.length||t.length===e.length&&t.every((function(t,n){var r=t.resources.map((function(t){return t.id})),o=e[n].resources.map((function(t){return t.id}));return 0===r.length&&0===o.length||r.length===o.length&&!(t.id!==e[n].id||!h()(r,o))})))}}],r&&B(n.prototype,r),o&&B(n,o),Object.defineProperty(n,"prototype",{writable:!1}),e}(l.Component);q.defaultProps={annotations:[],deselectAnnotation:function(){},drawAnnotations:!0,drawSearchAnnotations:!0,highlightAllAnnotations:!1,hoverAnnotation:function(){},hoveredAnnotationIds:[],palette:{},searchAnnotations:[],selectAnnotation:function(){},selectedAnnotationId:void 0,viewer:null};var Y=n(73953),G=n(32012),L=n(42383),K=n(1172),Q=n(80923),tt=n(81610),et=n(51580),nt={deselectAnnotation:Y.D6,hoverAnnotation:Y.G3,selectAnnotation:Y.XD},rt=(0,r.qC)((0,i.Zh)(),(0,o.$j)((function(t,e){var n=e.windowId;return{annotations:(0,G.A7)(t,{windowId:n}),canvasWorld:(0,L.B)(t,{windowId:n}),drawAnnotations:(0,K.iE)(t).window.forceDrawAnnotations||(0,Q.ig)(t,{content:"annotations",windowId:n}).length>0,drawSearchAnnotations:(0,K.iE)(t).window.forceDrawAnnotations||(0,Q.ig)(t,{content:"search",windowId:n}).length>0,highlightAllAnnotations:(0,tt.Jj)(t,{windowId:n}).highlightAllAnnotations,hoveredAnnotationIds:(0,tt.Jj)(t,{windowId:n}).hoveredAnnotationIds,palette:(0,K.gh)(t).palette,searchAnnotations:(0,et.kM)(t,{windowId:n}),selectedAnnotationId:(0,G.EO)(t,{windowId:n})}}),nt),(0,c.A)("AnnotationsOverlay"))(q),ot=n(95450),it={get:function(t){return this.refs[t]},refs:{},set:function(t,e){this.refs[t]=e}};function at(t,e,n){if(pt())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var o=new(t.bind.apply(t,r));return n&&wt(o,n.prototype),o}function st(t){return function(t){if(Array.isArray(t))return ct(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return ct(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ct(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ct(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function lt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ut(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?lt(Object(n),!0).forEach((function(e){ft(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):lt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function ft(t,e,n){return(e=vt(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function dt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,vt(r.key),r)}}function vt(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}function ht(t,e,n){return e=gt(e),function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return yt(t)}(t,pt()?Reflect.construct(e,n||[],gt(t).constructor):e.apply(t,n))}function pt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(pt=function(){return!!t})()}function gt(t){return gt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},gt(t)}function yt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function wt(t,e){return wt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},wt(t,e)}var mt=(0,u.ZP)("section")({cursor:"grab",flex:1,position:"relative"}),bt=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=ht(this,e,[t])).state={grabbing:!1,viewer:void 0},n.ref=(0,l.createRef)(),n.apiRef=(0,l.createRef)(),it.set(t.windowId,n.apiRef),n.onCanvasMouseMove=d()(n.onCanvasMouseMove.bind(yt(n)),10),n.onViewportChange=n.onViewportChange.bind(yt(n)),n.zoomToWorld=n.zoomToWorld.bind(yt(n)),n.osdUpdating=!1,n}var n,r,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&wt(t,e)}(e,t),n=e,r=[{key:"componentDidMount",value:function(){var t=this,e=this.props,n=e.osdConfig,r=e.t,o=e.windowId;if(this.ref.current){var i=new(g())(ut({id:this.ref.current.id},n)),a=i.canvas&&i.canvas.firstElementChild;a&&(a.setAttribute("role","img"),a.setAttribute("aria-label",r("digitizedView")),a.setAttribute("aria-describedby","".concat(o,"-osd"))),this.apiRef.current=i,this.setState({viewer:i}),i.addHandler("canvas-drag",(function(){t.setState({grabbing:!0})})),i.addHandler("canvas-drag-end",(function(){t.setState({grabbing:!1})})),i.addHandler("animation-start",(function(){t.osdUpdating=!0})),i.addHandler("animation-finish",this.onViewportChange),i.addHandler("animation-finish",(function(){t.osdUpdating=!1})),i.innerTracker&&(i.innerTracker.moveHandler=this.onCanvasMouseMove)}}},{key:"componentDidUpdate",value:function(t,e){var n=this.props,r=n.viewerConfig,o=n.canvasWorld,i=this.state.viewer;if(this.apiRef.current=i,void 0===e.viewer)return r&&(i.viewport.panTo(r,!0),i.viewport.zoomTo(r.zoom,r,!0),void 0!==r.degrees&&i.viewport.setRotation(r.degrees),void 0!==r.flip&&i.viewport.setFlip(r.flip)),void this.addAllImageSources(!r);if(this.infoResponsesMatch(t.infoResponses)&&this.nonTiledImagedMatch(t.nonTiledImages))if(h()(o.layers,t.canvasWorld.layers)){if(r&&!this.osdUpdating){var a=i.viewport;r.x===a.centerSpringX.target.value&&r.y===a.centerSpringY.target.value||a.panTo(r,!1),r.zoom!==a.zoomSpring.target.value&&a.zoomTo(r.zoom,r,!1),r.rotation!==a.getRotation()&&a.setRotation(r.rotation),r.flip!==a.getFlip()&&a.setFlip(r.flip)}}else this.refreshTileProperties();else{i.close();var s=!h()(o.canvasIds,t.canvasWorld.canvasIds);this.addAllImageSources(s||!r)}}},{key:"componentWillUnmount",value:function(){var t=this.state.viewer;t.innerTracker&&t.innerTracker.moveHandler===this.onCanvasMouseMove&&(t.innerTracker.moveHandler=null),t.removeAllHandlers(),this.onCanvasMouseMove.cancel(),this.apiRef.current=void 0}},{key:"onCanvasMouseMove",value:function(t){this.state.viewer.raiseEvent("mouse-move",t)}},{key:"onViewportChange",value:function(t){var e=this.props,n=e.updateViewport,r=e.windowId,o=t.eventSource.viewport;n(r,{flip:o.getFlip(),rotation:o.getRotation(),x:Math.round(o.centerSpringX.target.value),y:Math.round(o.centerSpringY.target.value),zoom:o.zoomSpring.target.value})}},{key:"addAllImageSources",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=this.props,r=n.nonTiledImages,o=n.infoResponses;return Promise.allSettled([].concat(st(o.map((function(e){return t.addTileSource(e)}))),st(r.map((function(e){return t.addNonTiledImage(e)}))))).then((function(){(o[0]||r[0])&&(e&&t.zoomToWorld(),t.refreshTileProperties())}))}},{key:"addNonTiledImage",value:function(t){var e=this.props.canvasWorld,n=this.state.viewer,r=t.getProperty("type"),o=t.getProperty("format")||"";return"Image"===r||"dctypes:Image"===r||o.startsWith("image/")?new Promise((function(r,o){r(n.addSimpleImage({error:function(t){return o(t)},fitBounds:at(g().Rect,st(e.contentResourceToWorldCoordinates(t))),index:e.layerIndexOfImageResource(t),opacity:e.layerOpacityOfImageResource(t),success:function(t){return r(t)},url:t.id}))})):Promise.resolve()}},{key:"addTileSource",value:function(t){var e=this.props.canvasWorld,n=this.state.viewer;return new Promise((function(r,o){var i=ut({},t.json),a=e.contentResource(t.id);a&&n.addTiledImage({error:function(t){return o(t)},fitBounds:at(g().Rect,st(e.contentResourceToWorldCoordinates(a))),index:e.layerIndexOfImageResource(a),opacity:e.layerOpacityOfImageResource(a),success:function(t){return r(t)},tileSource:i})}))}},{key:"refreshTileProperties",value:function(){for(var t=this.props.canvasWorld,e=this.state.viewer.world,n=[],r=0;r<e.getItemCount();r+=1)n.push(e.getItemAt(r));n.forEach((function(n,r){var o=t.contentResource(n.source["@id"]||n.source.id);if(o){var i=t.layerIndexOfImageResource(o);r!==i&&e.setItemIndex(n,i),n.setOpacity(t.layerOpacityOfImageResource(o))}}))}},{key:"fitBounds",value:function(t,e,n,r){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=this.state.viewer;i&&i.viewport&&i.viewport.fitBounds(new(g().Rect)(t,e,n,r),o)}},{key:"infoResponsesMatch",value:function(t){var e=this.props.infoResponses;return 0===e.length&&0===t.length||e.length===t.length&&e.every((function(e,n){return!!(t[n]&&e.json&&t[n].json&&e.tokenServiceId===t[n].tokenServiceId&&(e.json["@id"]&&e.json["@id"]===t[n].json["@id"]||e.json.id&&e.json.id===t[n].json.id))}))}},{key:"nonTiledImagedMatch",value:function(t){var e=this.props.nonTiledImages;return 0===e.length&&0===t.length||e.some((function(e,n){return!!t[n]&&e.id===t[n].id}))}},{key:"zoomToWorld",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.props.canvasWorld;this.fitBounds.apply(this,st(e.worldBounds()).concat([t]))}},{key:"render",value:function(){var t=this,e=this.props,n=e.children,r=e.label,o=e.t,i=e.windowId,a=e.drawAnnotations,s=this.state,c=s.viewer,u=s.grabbing,f=l.Children.map(n,(function(e){return(0,l.cloneElement)(e,{zoomToWorld:t.zoomToWorld})}));return(0,W.jsxs)(mt,{className:w()((0,m.Z)("osd-container")),style:{cursor:u?"grabbing":void 0},id:"".concat(i,"-osd"),ref:this.ref,"aria-label":o("item",{label:r}),"aria-live":"polite",children:[a&&(0,W.jsx)(rt,{viewer:c,windowId:i}),f,(0,W.jsx)(ot.M,ut({viewer:c},ut(ut({},this.props),{},{children:null})))]})}}],r&&dt(n.prototype,r),o&&dt(n,o),Object.defineProperty(n,"prototype",{writable:!1}),e}(l.Component);bt.defaultProps={children:null,drawAnnotations:!1,infoResponses:[],label:null,nonTiledImages:[],osdConfig:{},viewerConfig:null};var At=n(36691),Ot=n(49455),xt={updateViewport:At.WH},It=(0,r.qC)((0,i.Zh)(),(0,o.$j)((function(t,e){var n=e.windowId,r=(0,L.B)(t,{windowId:n}),o=(0,Ot.k5)(t),i=s()(r.canvases.map((function(t){return t.imageServiceIds})));return{canvasWorld:r,drawAnnotations:(0,K.iE)(t).window.forceDrawAnnotations||(0,Q.ig)(t,{content:"annotations",windowId:n}).length>0||(0,Q.ig)(t,{content:"search",windowId:n}).length>0,infoResponses:i.map((function(t){return o[t]})).filter((function(t){return void 0!==t&&!1===t.isFetching&&void 0===t.error})),label:(0,Ot.vt)(t,{canvasId:((0,Ot.Pm)(t,{windowId:n})||{}).id,windowId:n}),nonTiledImages:(0,Ot.Fg)(t,{windowId:n}),osdConfig:(0,K.iE)(t).osdConfig,viewerConfig:(0,tt.gA)(t,{windowId:n})}}),xt),(0,c.A)("OpenSeadragonViewer"))(bt)}}]);
//# sourceMappingURL=501-1ea29e3fc5d6894086c5.js.map