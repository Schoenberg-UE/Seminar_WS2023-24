{"version":3,"file":"501-1ea29e3fc5d6894086c5.js","mappings":"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","sources":["webpack://schoenberg-letters/./node_modules/lodash/_baseMap.js","webpack://schoenberg-letters/./node_modules/lodash/_baseOrderBy.js","webpack://schoenberg-letters/./node_modules/lodash/_baseSortBy.js","webpack://schoenberg-letters/./node_modules/lodash/_baseXor.js","webpack://schoenberg-letters/./node_modules/lodash/_compareAscending.js","webpack://schoenberg-letters/./node_modules/lodash/_compareMultiple.js","webpack://schoenberg-letters/./node_modules/lodash/_isIterateeCall.js","webpack://schoenberg-letters/./node_modules/lodash/sortBy.js","webpack://schoenberg-letters/./node_modules/lodash/xor.js","webpack://schoenberg-letters/./node_modules/mirador/dist/es/src/lib/OpenSeadragonCanvasOverlay.js","webpack://schoenberg-letters/./node_modules/mirador/dist/es/src/lib/CanvasAnnotationDisplay.js","webpack://schoenberg-letters/./node_modules/mirador/dist/es/src/components/AnnotationsOverlay.js","webpack://schoenberg-letters/./node_modules/mirador/dist/es/src/containers/AnnotationsOverlay.js","webpack://schoenberg-letters/./node_modules/mirador/dist/es/src/plugins/OSDReferences.js","webpack://schoenberg-letters/./node_modules/mirador/dist/es/src/components/OpenSeadragonViewer.js","webpack://schoenberg-letters/./node_modules/mirador/dist/es/src/containers/OpenSeadragonViewer.js"],"sourcesContent":["var baseEach = require('./_baseEach'),\n    isArrayLike = require('./isArrayLike');\n\n/**\n * The base implementation of `_.map` without support for iteratee shorthands.\n *\n * @private\n * @param {Array|Object} collection The collection to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the new mapped array.\n */\nfunction baseMap(collection, iteratee) {\n  var index = -1,\n      result = isArrayLike(collection) ? Array(collection.length) : [];\n\n  baseEach(collection, function(value, key, collection) {\n    result[++index] = iteratee(value, key, collection);\n  });\n  return result;\n}\n\nmodule.exports = baseMap;\n","var arrayMap = require('./_arrayMap'),\n    baseGet = require('./_baseGet'),\n    baseIteratee = require('./_baseIteratee'),\n    baseMap = require('./_baseMap'),\n    baseSortBy = require('./_baseSortBy'),\n    baseUnary = require('./_baseUnary'),\n    compareMultiple = require('./_compareMultiple'),\n    identity = require('./identity'),\n    isArray = require('./isArray');\n\n/**\n * The base implementation of `_.orderBy` without param guards.\n *\n * @private\n * @param {Array|Object} collection The collection to iterate over.\n * @param {Function[]|Object[]|string[]} iteratees The iteratees to sort by.\n * @param {string[]} orders The sort orders of `iteratees`.\n * @returns {Array} Returns the new sorted array.\n */\nfunction baseOrderBy(collection, iteratees, orders) {\n  if (iteratees.length) {\n    iteratees = arrayMap(iteratees, function(iteratee) {\n      if (isArray(iteratee)) {\n        return function(value) {\n          return baseGet(value, iteratee.length === 1 ? iteratee[0] : iteratee);\n        }\n      }\n      return iteratee;\n    });\n  } else {\n    iteratees = [identity];\n  }\n\n  var index = -1;\n  iteratees = arrayMap(iteratees, baseUnary(baseIteratee));\n\n  var result = baseMap(collection, function(value, key, collection) {\n    var criteria = arrayMap(iteratees, function(iteratee) {\n      return iteratee(value);\n    });\n    return { 'criteria': criteria, 'index': ++index, 'value': value };\n  });\n\n  return baseSortBy(result, function(object, other) {\n    return compareMultiple(object, other, orders);\n  });\n}\n\nmodule.exports = baseOrderBy;\n","/**\n * The base implementation of `_.sortBy` which uses `comparer` to define the\n * sort order of `array` and replaces criteria objects with their corresponding\n * values.\n *\n * @private\n * @param {Array} array The array to sort.\n * @param {Function} comparer The function to define sort order.\n * @returns {Array} Returns `array`.\n */\nfunction baseSortBy(array, comparer) {\n  var length = array.length;\n\n  array.sort(comparer);\n  while (length--) {\n    array[length] = array[length].value;\n  }\n  return array;\n}\n\nmodule.exports = baseSortBy;\n","var baseDifference = require('./_baseDifference'),\n    baseFlatten = require('./_baseFlatten'),\n    baseUniq = require('./_baseUniq');\n\n/**\n * The base implementation of methods like `_.xor`, without support for\n * iteratee shorthands, that accepts an array of arrays to inspect.\n *\n * @private\n * @param {Array} arrays The arrays to inspect.\n * @param {Function} [iteratee] The iteratee invoked per element.\n * @param {Function} [comparator] The comparator invoked per element.\n * @returns {Array} Returns the new array of values.\n */\nfunction baseXor(arrays, iteratee, comparator) {\n  var length = arrays.length;\n  if (length < 2) {\n    return length ? baseUniq(arrays[0]) : [];\n  }\n  var index = -1,\n      result = Array(length);\n\n  while (++index < length) {\n    var array = arrays[index],\n        othIndex = -1;\n\n    while (++othIndex < length) {\n      if (othIndex != index) {\n        result[index] = baseDifference(result[index] || array, arrays[othIndex], iteratee, comparator);\n      }\n    }\n  }\n  return baseUniq(baseFlatten(result, 1), iteratee, comparator);\n}\n\nmodule.exports = baseXor;\n","var isSymbol = require('./isSymbol');\n\n/**\n * Compares values to sort them in ascending order.\n *\n * @private\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {number} Returns the sort order indicator for `value`.\n */\nfunction compareAscending(value, other) {\n  if (value !== other) {\n    var valIsDefined = value !== undefined,\n        valIsNull = value === null,\n        valIsReflexive = value === value,\n        valIsSymbol = isSymbol(value);\n\n    var othIsDefined = other !== undefined,\n        othIsNull = other === null,\n        othIsReflexive = other === other,\n        othIsSymbol = isSymbol(other);\n\n    if ((!othIsNull && !othIsSymbol && !valIsSymbol && value > other) ||\n        (valIsSymbol && othIsDefined && othIsReflexive && !othIsNull && !othIsSymbol) ||\n        (valIsNull && othIsDefined && othIsReflexive) ||\n        (!valIsDefined && othIsReflexive) ||\n        !valIsReflexive) {\n      return 1;\n    }\n    if ((!valIsNull && !valIsSymbol && !othIsSymbol && value < other) ||\n        (othIsSymbol && valIsDefined && valIsReflexive && !valIsNull && !valIsSymbol) ||\n        (othIsNull && valIsDefined && valIsReflexive) ||\n        (!othIsDefined && valIsReflexive) ||\n        !othIsReflexive) {\n      return -1;\n    }\n  }\n  return 0;\n}\n\nmodule.exports = compareAscending;\n","var compareAscending = require('./_compareAscending');\n\n/**\n * Used by `_.orderBy` to compare multiple properties of a value to another\n * and stable sort them.\n *\n * If `orders` is unspecified, all values are sorted in ascending order. Otherwise,\n * specify an order of \"desc\" for descending or \"asc\" for ascending sort order\n * of corresponding values.\n *\n * @private\n * @param {Object} object The object to compare.\n * @param {Object} other The other object to compare.\n * @param {boolean[]|string[]} orders The order to sort by for each property.\n * @returns {number} Returns the sort order indicator for `object`.\n */\nfunction compareMultiple(object, other, orders) {\n  var index = -1,\n      objCriteria = object.criteria,\n      othCriteria = other.criteria,\n      length = objCriteria.length,\n      ordersLength = orders.length;\n\n  while (++index < length) {\n    var result = compareAscending(objCriteria[index], othCriteria[index]);\n    if (result) {\n      if (index >= ordersLength) {\n        return result;\n      }\n      var order = orders[index];\n      return result * (order == 'desc' ? -1 : 1);\n    }\n  }\n  // Fixes an `Array#sort` bug in the JS engine embedded in Adobe applications\n  // that causes it, under certain circumstances, to provide the same value for\n  // `object` and `other`. See https://github.com/jashkenas/underscore/pull/1247\n  // for more details.\n  //\n  // This also ensures a stable sort in V8 and other engines.\n  // See https://bugs.chromium.org/p/v8/issues/detail?id=90 for more details.\n  return object.index - other.index;\n}\n\nmodule.exports = compareMultiple;\n","var eq = require('./eq'),\n    isArrayLike = require('./isArrayLike'),\n    isIndex = require('./_isIndex'),\n    isObject = require('./isObject');\n\n/**\n * Checks if the given arguments are from an iteratee call.\n *\n * @private\n * @param {*} value The potential iteratee value argument.\n * @param {*} index The potential iteratee index or key argument.\n * @param {*} object The potential iteratee object argument.\n * @returns {boolean} Returns `true` if the arguments are from an iteratee call,\n *  else `false`.\n */\nfunction isIterateeCall(value, index, object) {\n  if (!isObject(object)) {\n    return false;\n  }\n  var type = typeof index;\n  if (type == 'number'\n        ? (isArrayLike(object) && isIndex(index, object.length))\n        : (type == 'string' && index in object)\n      ) {\n    return eq(object[index], value);\n  }\n  return false;\n}\n\nmodule.exports = isIterateeCall;\n","var baseFlatten = require('./_baseFlatten'),\n    baseOrderBy = require('./_baseOrderBy'),\n    baseRest = require('./_baseRest'),\n    isIterateeCall = require('./_isIterateeCall');\n\n/**\n * Creates an array of elements, sorted in ascending order by the results of\n * running each element in a collection thru each iteratee. This method\n * performs a stable sort, that is, it preserves the original sort order of\n * equal elements. The iteratees are invoked with one argument: (value).\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Collection\n * @param {Array|Object} collection The collection to iterate over.\n * @param {...(Function|Function[])} [iteratees=[_.identity]]\n *  The iteratees to sort by.\n * @returns {Array} Returns the new sorted array.\n * @example\n *\n * var users = [\n *   { 'user': 'fred',   'age': 48 },\n *   { 'user': 'barney', 'age': 36 },\n *   { 'user': 'fred',   'age': 30 },\n *   { 'user': 'barney', 'age': 34 }\n * ];\n *\n * _.sortBy(users, [function(o) { return o.user; }]);\n * // => objects for [['barney', 36], ['barney', 34], ['fred', 48], ['fred', 30]]\n *\n * _.sortBy(users, ['user', 'age']);\n * // => objects for [['barney', 34], ['barney', 36], ['fred', 30], ['fred', 48]]\n */\nvar sortBy = baseRest(function(collection, iteratees) {\n  if (collection == null) {\n    return [];\n  }\n  var length = iteratees.length;\n  if (length > 1 && isIterateeCall(collection, iteratees[0], iteratees[1])) {\n    iteratees = [];\n  } else if (length > 2 && isIterateeCall(iteratees[0], iteratees[1], iteratees[2])) {\n    iteratees = [iteratees[0]];\n  }\n  return baseOrderBy(collection, baseFlatten(iteratees, 1), []);\n});\n\nmodule.exports = sortBy;\n","var arrayFilter = require('./_arrayFilter'),\n    baseRest = require('./_baseRest'),\n    baseXor = require('./_baseXor'),\n    isArrayLikeObject = require('./isArrayLikeObject');\n\n/**\n * Creates an array of unique values that is the\n * [symmetric difference](https://en.wikipedia.org/wiki/Symmetric_difference)\n * of the given arrays. The order of result values is determined by the order\n * they occur in the arrays.\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Array\n * @param {...Array} [arrays] The arrays to inspect.\n * @returns {Array} Returns the new array of filtered values.\n * @see _.difference, _.without\n * @example\n *\n * _.xor([2, 1], [2, 3]);\n * // => [1, 3]\n */\nvar xor = baseRest(function(arrays) {\n  return baseXor(arrayFilter(arrays, isArrayLikeObject));\n});\n\nmodule.exports = xor;\n","function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == typeof i ? i : String(i); }\nfunction _toPrimitive(t, r) { if (\"object\" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != typeof i) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nimport OpenSeadragon from 'openseadragon';\n\n/**\n * OpenSeadragonCanvasOverlay - adapted from https://github.com/altert/OpenSeadragonCanvasOverlay\n * used rather than an \"onRedraw\" function we tap into our own method. Existing\n * repository is not published as an npm package.\n * Code ported from https://github.com/altert/OpenSeadragonCanvasOverlay\n * carries a BSD 3-Clause license originally authored by @altert from\n * https://github.com/altert/OpenseadragonFabricjsOverlay\n */\nvar OpenSeadragonCanvasOverlay = /*#__PURE__*/function () {\n  /**\n   * constructor - sets up the Canvas overlay container\n   */\n  function OpenSeadragonCanvasOverlay(viewer, ref) {\n    _classCallCheck(this, OpenSeadragonCanvasOverlay);\n    this.viewer = viewer;\n    this.ref = ref;\n    this.containerWidth = 0;\n    this.containerHeight = 0;\n    this.imgAspectRatio = 1;\n  }\n\n  /** */\n  _createClass(OpenSeadragonCanvasOverlay, [{\n    key: \"canvas\",\n    get: function get() {\n      return this.canvasDiv.firstElementChild;\n    }\n\n    /** */\n  }, {\n    key: \"canvasDiv\",\n    get: function get() {\n      return this.ref.current;\n    }\n\n    /** */\n  }, {\n    key: \"context2d\",\n    get: function get() {\n      return this.canvas.getContext('2d');\n    }\n\n    /** */\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      this.context2d.clearRect(0, 0, this.containerWidth, this.containerHeight);\n    }\n\n    /**\n     * resize - resizes the added Canvas overlay.\n     */\n  }, {\n    key: \"resize\",\n    value: function resize() {\n      if (this.containerWidth !== this.viewer.container.clientWidth) {\n        this.containerWidth = this.viewer.container.clientWidth;\n        this.canvasDiv.setAttribute('width', this.containerWidth);\n        this.canvas.setAttribute('width', this.containerWidth);\n      }\n      if (this.containerHeight !== this.viewer.container.clientHeight) {\n        this.containerHeight = this.viewer.container.clientHeight;\n        this.canvasDiv.setAttribute('height', this.containerHeight);\n        this.canvas.setAttribute('height', this.containerHeight);\n      }\n      this.viewportOrigin = new OpenSeadragon.Point(0, 0);\n      var boundsRect = this.viewer.viewport.getBoundsNoRotateWithMargins(true);\n      this.viewportOrigin.x = boundsRect.x;\n      this.viewportOrigin.y = boundsRect.y * this.imgAspectRatio;\n      this.viewportWidth = boundsRect.width;\n      this.viewportHeight = boundsRect.height * this.imgAspectRatio;\n      var image1 = this.viewer.world.getItemAt(0);\n      if (!image1) return;\n      this.imgWidth = image1.source.dimensions.x;\n      this.imgHeight = image1.source.dimensions.y;\n      this.imgAspectRatio = this.imgWidth / this.imgHeight;\n    }\n\n    /**\n     * canvasUpdate - sets up the dimensions for the canvas update to mimick image\n     * 0 dimensions. Then call provided update function.\n     * @param {Function} update\n     */\n  }, {\n    key: \"canvasUpdate\",\n    value: function canvasUpdate(update) {\n      var viewportZoom = this.viewer.viewport.getZoom(true);\n      var image1 = this.viewer.world.getItemAt(0);\n      if (!image1) return;\n      var zoom = image1.viewportToImageZoom(viewportZoom);\n      var x = (this.viewportOrigin.x / this.imgWidth - this.viewportOrigin.x) / this.viewportWidth * this.containerWidth;\n      var y = (this.viewportOrigin.y / this.imgHeight - this.viewportOrigin.y) / this.viewportHeight * this.containerHeight;\n      if (this.clearBeforeRedraw) this.clear();\n      this.context2d.translate(x, y);\n      this.context2d.scale(zoom, zoom);\n      var center = this.viewer.viewport.getCenter();\n      var flip = this.viewer.viewport.getFlip();\n      if (flip) {\n        this.context2d.translate(center.x * 2, 0);\n        this.context2d.scale(-1, 1);\n      }\n      var rotation = this.viewer.viewport.getRotation();\n      if (rotation !== 0) {\n        this.context2d.translate(center.x, center.y);\n        this.context2d.rotate(rotation * Math.PI / 180);\n        this.context2d.translate(-1 * center.x, -1 * center.y);\n      }\n      update();\n      this.context2d.setTransform(1, 0, 0, 1, 0, 0);\n    }\n  }]);\n  return OpenSeadragonCanvasOverlay;\n}();\nexport { OpenSeadragonCanvasOverlay as default };","function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == typeof i ? i : String(i); }\nfunction _toPrimitive(t, r) { if (\"object\" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != typeof i) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\n/**\n * CanvasAnnotationDisplay - class used to display a SVG and fragment based\n * annotations.\n */\nvar CanvasAnnotationDisplay = /*#__PURE__*/function () {\n  /** */\n  function CanvasAnnotationDisplay(_ref) {\n    var resource = _ref.resource,\n      palette = _ref.palette,\n      zoomRatio = _ref.zoomRatio,\n      offset = _ref.offset,\n      selected = _ref.selected,\n      hovered = _ref.hovered;\n    _classCallCheck(this, CanvasAnnotationDisplay);\n    this.resource = resource;\n    this.palette = palette;\n    this.zoomRatio = zoomRatio;\n    this.offset = offset;\n    this.selected = selected;\n    this.hovered = hovered;\n  }\n\n  /** */\n  _createClass(CanvasAnnotationDisplay, [{\n    key: \"toContext\",\n    value: function toContext(context) {\n      this.context = context;\n      if (this.resource.svgSelector) {\n        this.svgContext();\n      } else if (this.resource.fragmentSelector) {\n        this.fragmentContext();\n      }\n    }\n\n    /** */\n  }, {\n    key: \"svgString\",\n    get: function get() {\n      return this.resource.svgSelector.value;\n    }\n\n    /** */\n  }, {\n    key: \"svgContext\",\n    value: function svgContext() {\n      var _this = this;\n      var currentPalette;\n      if (this.hovered) {\n        currentPalette = this.palette.hovered;\n      } else if (this.selected) {\n        currentPalette = this.palette.selected;\n      } else {\n        currentPalette = this.palette[\"default\"];\n      }\n      if (currentPalette.globalAlpha === 0) return;\n      _toConsumableArray(this.svgPaths).forEach(function (element) {\n        /**\n         *  Note: Path2D is not supported in IE11.\n         *  TODO: Support multi canvas offset\n         *  One example: https://developer.mozilla.org/en-US/docs/Web/API/Path2D/addPath\n         */\n        _this.context.save();\n        _this.context.translate(_this.offset.x, _this.offset.y);\n        var p = new Path2D(element.attributes.d.nodeValue);\n\n        // Setup styling from SVG -> Canvas\n        _this.context.strokeStyle = _this.color;\n        if (element.attributes['stroke-dasharray']) {\n          _this.context.setLineDash(element.attributes['stroke-dasharray'].nodeValue.split(','));\n        }\n        var svgToCanvasMap = {\n          fill: 'fillStyle',\n          stroke: 'strokeStyle',\n          'stroke-dashoffset': 'lineDashOffset',\n          'stroke-linecap': 'lineCap',\n          'stroke-linejoin': 'lineJoin',\n          'stroke-miterlimit': 'miterlimit',\n          'stroke-width': 'lineWidth'\n        };\n        Object.keys(svgToCanvasMap).forEach(function (key) {\n          if (element.attributes[key]) {\n            _this.context[svgToCanvasMap[key]] = element.attributes[key].nodeValue;\n          }\n        });\n\n        // Resize the stroke based off of the zoomRatio (currentZoom / maxZoom)\n        _this.context.lineWidth /= _this.zoomRatio;\n\n        // Reset the color if it is selected or hovered on\n        if (_this.selected || _this.hovered) {\n          _this.context.strokeStyle = currentPalette.strokeStyle || currentPalette.fillStyle;\n        }\n        if (element.attributes['stroke-opacity']) {\n          _this.context.globalAlpha = currentPalette.globalAlpha * element.attributes['stroke-opacity'].nodeValue;\n        } else {\n          _this.context.globalAlpha = currentPalette.globalAlpha;\n        }\n        _this.context.stroke(p);\n\n        // Wait to set the fill, so we can adjust the globalAlpha value if we need to\n        if (element.attributes.fill && element.attributes.fill.nodeValue !== 'none') {\n          if (element.attributes['fill-opacity']) {\n            _this.context.globalAlpha = currentPalette.globalAlpha * element.attributes['fill-opacity'].nodeValue;\n          } else {\n            _this.context.globalAlpha = currentPalette.globalAlpha;\n          }\n          _this.context.fill(p);\n        }\n        _this.context.restore();\n      });\n    }\n\n    /** */\n  }, {\n    key: \"fragmentContext\",\n    value: function fragmentContext() {\n      var _this2 = this;\n      var fragment = this.resource.fragmentSelector;\n      fragment[0] += this.offset.x;\n      fragment[1] += this.offset.y;\n      var currentPalette;\n      if (this.selected) {\n        currentPalette = this.palette.selected;\n      } else if (this.hovered) {\n        currentPalette = this.palette.hovered;\n      } else {\n        currentPalette = this.palette[\"default\"];\n      }\n      this.context.save();\n      Object.keys(currentPalette).forEach(function (key) {\n        _this2.context[key] = currentPalette[key];\n      });\n      if (currentPalette.globalAlpha === 0) return;\n      if (currentPalette.fillStyle) {\n        var _this$context;\n        (_this$context = this.context).fillRect.apply(_this$context, _toConsumableArray(fragment));\n      } else {\n        var _this$context2;\n        this.context.lineWidth = 1 / this.zoomRatio;\n        (_this$context2 = this.context).strokeRect.apply(_this$context2, _toConsumableArray(fragment));\n      }\n      this.context.restore();\n    }\n\n    /** */\n  }, {\n    key: \"svgPaths\",\n    get: function get() {\n      var parser = new DOMParser();\n      var xmlDoc = parser.parseFromString(this.svgString, 'text/xml');\n      return xmlDoc.getElementsByTagName('path');\n    }\n  }]);\n  return CanvasAnnotationDisplay;\n}();\nexport { CanvasAnnotationDisplay as default };","function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nfunction _iterableToArrayLimit(r, l) { var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t[\"return\"] && (u = t[\"return\"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == typeof i ? i : String(i); }\nfunction _toPrimitive(t, r) { if (\"object\" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != typeof i) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nfunction _callSuper(t, o, e) { return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e)); }\nfunction _possibleConstructorReturn(self, call) { if (call && (typeof call === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\nfunction _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\nimport { createRef, Component } from 'react';\nimport ReactDOM from 'react-dom';\nimport isEqual from 'lodash/isEqual';\nimport debounce from 'lodash/debounce';\nimport flatten from 'lodash/flatten';\nimport sortBy from 'lodash/sortBy';\nimport xor from 'lodash/xor';\nimport OpenSeadragonCanvasOverlay from '../lib/OpenSeadragonCanvasOverlay';\nimport CanvasWorld from '../lib/CanvasWorld';\nimport CanvasAnnotationDisplay from '../lib/CanvasAnnotationDisplay';\n\n/**\n * Represents a OpenSeadragonViewer in the mirador workspace. Responsible for mounting\n * and rendering OSD.\n */\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport var AnnotationsOverlay = /*#__PURE__*/function (_Component) {\n  _inherits(AnnotationsOverlay, _Component);\n  /**\n   * @param {Object} props\n   */\n  function AnnotationsOverlay(props) {\n    var _this;\n    _classCallCheck(this, AnnotationsOverlay);\n    _this = _callSuper(this, AnnotationsOverlay, [props]);\n    _this.ref = /*#__PURE__*/createRef();\n    _this.osdCanvasOverlay = null;\n    // An initial value for the updateCanvas method\n    _this.updateCanvas = function () {};\n    _this.onUpdateViewport = _this.onUpdateViewport.bind(_assertThisInitialized(_this));\n    _this.onCanvasClick = _this.onCanvasClick.bind(_assertThisInitialized(_this));\n    _this.onCanvasMouseMove = debounce(_this.onCanvasMouseMove.bind(_assertThisInitialized(_this)), 10);\n    _this.onCanvasExit = _this.onCanvasExit.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n\n  /**\n   * React lifecycle event\n   */\n  _createClass(AnnotationsOverlay, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.initializeViewer();\n    }\n\n    /**\n     * When the tileSources change, make sure to close the OSD viewer.\n     * When the annotations change, reset the updateCanvas method to make sure\n     * they are added.\n     * When the viewport state changes, pan or zoom the OSD viewer as appropriate\n     */\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      var _this$props = this.props,\n        drawAnnotations = _this$props.drawAnnotations,\n        drawSearchAnnotations = _this$props.drawSearchAnnotations,\n        annotations = _this$props.annotations,\n        searchAnnotations = _this$props.searchAnnotations,\n        hoveredAnnotationIds = _this$props.hoveredAnnotationIds,\n        selectedAnnotationId = _this$props.selectedAnnotationId,\n        highlightAllAnnotations = _this$props.highlightAllAnnotations,\n        viewer = _this$props.viewer;\n      this.initializeViewer();\n      var annotationsUpdated = !AnnotationsOverlay.annotationsMatch(annotations, prevProps.annotations);\n      var searchAnnotationsUpdated = !AnnotationsOverlay.annotationsMatch(searchAnnotations, prevProps.searchAnnotations);\n      var hoveredAnnotationsUpdated = xor(hoveredAnnotationIds, prevProps.hoveredAnnotationIds).length > 0;\n      if (this.osdCanvasOverlay && hoveredAnnotationsUpdated) {\n        if (hoveredAnnotationIds.length > 0) {\n          this.osdCanvasOverlay.canvasDiv.style.cursor = 'pointer';\n        } else {\n          this.osdCanvasOverlay.canvasDiv.style.cursor = '';\n        }\n      }\n      var selectedAnnotationsUpdated = selectedAnnotationId !== prevProps.selectedAnnotationId;\n      var redrawAnnotations = drawAnnotations !== prevProps.drawAnnotations || drawSearchAnnotations !== prevProps.drawSearchAnnotations || highlightAllAnnotations !== prevProps.highlightAllAnnotations;\n      if (searchAnnotationsUpdated || annotationsUpdated || selectedAnnotationsUpdated || hoveredAnnotationsUpdated || redrawAnnotations) {\n        this.updateCanvas = this.canvasUpdateCallback();\n        viewer.forceRedraw();\n      }\n    }\n\n    /**\n     */\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      var viewer = this.props.viewer;\n      this.onCanvasMouseMove.cancel();\n      viewer.removeHandler('canvas-click', this.onCanvasClick);\n      viewer.removeHandler('canvas-exit', this.onCanvasExit);\n      viewer.removeHandler('update-viewport', this.onUpdateViewport);\n      viewer.removeHandler('mouse-move', this.onCanvasMouseMove);\n    }\n\n    /** */\n  }, {\n    key: \"onCanvasClick\",\n    value: function onCanvasClick(event) {\n      var _this2 = this;\n      var canvasWorld = this.props.canvasWorld;\n      var webPosition = event.position,\n        viewport = event.eventSource.viewport;\n      var point = viewport.pointFromPixel(webPosition);\n      var canvas = canvasWorld.canvasAtPoint(point);\n      if (!canvas) return;\n      var _canvasWorld$canvasTo = canvasWorld.canvasToWorldCoordinates(canvas.id),\n        _canvasWorld$canvasTo2 = _slicedToArray(_canvasWorld$canvasTo, 4),\n        _canvasX = _canvasWorld$canvasTo2[0],\n        _canvasY = _canvasWorld$canvasTo2[1],\n        canvasWidth = _canvasWorld$canvasTo2[2],\n        canvasHeight // eslint-disable-line no-unused-vars\n        = _canvasWorld$canvasTo2[3];\n\n      // get all the annotations that contain the click\n      var annos = this.annotationsAtPoint(canvas, point);\n      if (annos.length > 0) {\n        event.preventDefaultAction = true; // eslint-disable-line no-param-reassign\n      }\n      if (annos.length === 1) {\n        this.toggleAnnotation(annos[0].id);\n      } else if (annos.length > 0) {\n        /**\n         * Try to find the \"right\" annotation to select after a click.\n         *\n         * This is perhaps a naive method, but seems to deal with rectangles and SVG shapes:\n         *\n         * - figure out how many points around a circle are inside the annotation shape\n         * - if there's a shape with the fewest interior points, it's probably the one\n         *       with the closest boundary?\n         * - if there's a tie, make the circle bigger and try again.\n         */\n        var annosWithClickScore = function annosWithClickScore(radius) {\n          var degreesToRadians = Math.PI / 180;\n          return function (anno) {\n            var score = 0;\n            for (var degrees = 0; degrees < 360; degrees += 1) {\n              var x = Math.cos(degrees * degreesToRadians) * radius + point.x;\n              var y = Math.sin(degrees * degreesToRadians) * radius + point.y;\n              if (_this2.isAnnotationAtPoint(anno, canvas, {\n                x: x,\n                y: y\n              })) score += 1;\n            }\n            return {\n              anno: anno,\n              score: score\n            };\n          };\n        };\n        var annosWithScore = [];\n        var radius = 1;\n        annosWithScore = sortBy(annos.map(annosWithClickScore(radius)), 'score');\n        while (radius < Math.max(canvasWidth, canvasHeight) && annosWithScore[0].score === annosWithScore[1].score) {\n          radius *= 2;\n          annosWithScore = sortBy(annos.map(annosWithClickScore(radius)), 'score');\n        }\n        this.toggleAnnotation(annosWithScore[0].anno.id);\n      }\n    }\n\n    /** */\n  }, {\n    key: \"onCanvasMouseMove\",\n    value: function onCanvasMouseMove(event) {\n      var _this$props2 = this.props,\n        annotations = _this$props2.annotations,\n        canvasWorld = _this$props2.canvasWorld,\n        hoverAnnotation = _this$props2.hoverAnnotation,\n        hoveredAnnotationIds = _this$props2.hoveredAnnotationIds,\n        searchAnnotations = _this$props2.searchAnnotations,\n        viewer = _this$props2.viewer,\n        windowId = _this$props2.windowId;\n      if (annotations.length === 0 && searchAnnotations.length === 0) return;\n      var webPosition = event.position;\n      var point = viewer.viewport.pointFromPixel(webPosition);\n      var canvas = canvasWorld.canvasAtPoint(point);\n      if (!canvas) {\n        hoverAnnotation(windowId, []);\n        return;\n      }\n      var annos = this.annotationsAtPoint(canvas, point);\n      if (xor(hoveredAnnotationIds, annos.map(function (a) {\n        return a.id;\n      })).length > 0) {\n        hoverAnnotation(windowId, annos.map(function (a) {\n          return a.id;\n        }));\n      }\n    }\n\n    /** If the cursor leaves the canvas, wipe out highlights */\n  }, {\n    key: \"onCanvasExit\",\n    value: function onCanvasExit(event) {\n      var _this$props3 = this.props,\n        hoverAnnotation = _this$props3.hoverAnnotation,\n        windowId = _this$props3.windowId;\n\n      // a move event may be queued up by the debouncer\n      this.onCanvasMouseMove.cancel();\n      hoverAnnotation(windowId, []);\n    }\n\n    /**\n     * onUpdateViewport - fires during OpenSeadragon render method.\n     */\n  }, {\n    key: \"onUpdateViewport\",\n    value: function onUpdateViewport(event) {\n      this.updateCanvas();\n    }\n\n    /** @private */\n  }, {\n    key: \"initializeViewer\",\n    value: function initializeViewer() {\n      var viewer = this.props.viewer;\n      if (!viewer) return;\n      if (this.osdCanvasOverlay) return;\n      this.osdCanvasOverlay = new OpenSeadragonCanvasOverlay(viewer, this.ref);\n      viewer.addHandler('canvas-click', this.onCanvasClick);\n      viewer.addHandler('canvas-exit', this.onCanvasExit);\n      viewer.addHandler('update-viewport', this.onUpdateViewport);\n      viewer.addHandler('mouse-move', this.onCanvasMouseMove);\n      this.updateCanvas = this.canvasUpdateCallback();\n    }\n\n    /** */\n  }, {\n    key: \"canvasUpdateCallback\",\n    value: function canvasUpdateCallback() {\n      var _this3 = this;\n      return function () {\n        _this3.osdCanvasOverlay.clear();\n        _this3.osdCanvasOverlay.resize();\n        _this3.osdCanvasOverlay.canvasUpdate(_this3.renderAnnotations.bind(_this3));\n      };\n    }\n\n    /** @private */\n  }, {\n    key: \"isAnnotationAtPoint\",\n    value: function isAnnotationAtPoint(resource, canvas, point) {\n      var canvasWorld = this.props.canvasWorld;\n      var _canvasWorld$canvasTo3 = canvasWorld.canvasToWorldCoordinates(canvas.id),\n        _canvasWorld$canvasTo4 = _slicedToArray(_canvasWorld$canvasTo3, 2),\n        canvasX = _canvasWorld$canvasTo4[0],\n        canvasY = _canvasWorld$canvasTo4[1];\n      var relativeX = point.x - canvasX;\n      var relativeY = point.y - canvasY;\n      if (resource.svgSelector) {\n        var context = this.osdCanvasOverlay.context2d;\n        var _CanvasAnnotationDisp = new CanvasAnnotationDisplay({\n            resource: resource\n          }),\n          svgPaths = _CanvasAnnotationDisp.svgPaths;\n        return _toConsumableArray(svgPaths).some(function (path) {\n          return context.isPointInPath(new Path2D(path.attributes.d.nodeValue), relativeX, relativeY);\n        });\n      }\n      if (resource.fragmentSelector) {\n        var _resource$fragmentSel = _slicedToArray(resource.fragmentSelector, 4),\n          x = _resource$fragmentSel[0],\n          y = _resource$fragmentSel[1],\n          w = _resource$fragmentSel[2],\n          h = _resource$fragmentSel[3];\n        return x <= relativeX && relativeX <= x + w && y <= relativeY && relativeY <= y + h;\n      }\n      return false;\n    }\n\n    /** @private */\n  }, {\n    key: \"annotationsAtPoint\",\n    value: function annotationsAtPoint(canvas, point) {\n      var _this4 = this;\n      var _this$props4 = this.props,\n        annotations = _this$props4.annotations,\n        searchAnnotations = _this$props4.searchAnnotations;\n      var lists = [].concat(_toConsumableArray(annotations), _toConsumableArray(searchAnnotations));\n      var annos = flatten(lists.map(function (l) {\n        return l.resources;\n      })).filter(function (resource) {\n        if (canvas.id !== resource.targetId) return false;\n        return _this4.isAnnotationAtPoint(resource, canvas, point);\n      });\n      return annos;\n    }\n\n    /** */\n  }, {\n    key: \"toggleAnnotation\",\n    value: function toggleAnnotation(id) {\n      var _this$props5 = this.props,\n        selectedAnnotationId = _this$props5.selectedAnnotationId,\n        selectAnnotation = _this$props5.selectAnnotation,\n        deselectAnnotation = _this$props5.deselectAnnotation,\n        windowId = _this$props5.windowId;\n      if (selectedAnnotationId === id) {\n        deselectAnnotation(windowId, id);\n      } else {\n        selectAnnotation(windowId, id);\n      }\n    }\n\n    /**\n     * annotationsToContext - converts anontations to a canvas context\n     */\n  }, {\n    key: \"annotationsToContext\",\n    value: function annotationsToContext(annotations, palette) {\n      var _this$props6 = this.props,\n        highlightAllAnnotations = _this$props6.highlightAllAnnotations,\n        hoveredAnnotationIds = _this$props6.hoveredAnnotationIds,\n        selectedAnnotationId = _this$props6.selectedAnnotationId,\n        canvasWorld = _this$props6.canvasWorld,\n        viewer = _this$props6.viewer;\n      var context = this.osdCanvasOverlay.context2d;\n      var zoomRatio = viewer.viewport.getZoom(true) / viewer.viewport.getMaxZoom();\n      annotations.forEach(function (annotation) {\n        annotation.resources.forEach(function (resource) {\n          if (!canvasWorld.canvasIds.includes(resource.targetId)) return;\n          var offset = canvasWorld.offsetByCanvas(resource.targetId);\n          var canvasAnnotationDisplay = new CanvasAnnotationDisplay({\n            hovered: hoveredAnnotationIds.includes(resource.id),\n            offset: offset,\n            palette: _objectSpread(_objectSpread({}, palette), {}, {\n              \"default\": _objectSpread(_objectSpread({}, palette[\"default\"]), !highlightAllAnnotations && palette.hidden)\n            }),\n            resource: resource,\n            selected: selectedAnnotationId === resource.id,\n            zoomRatio: zoomRatio\n          });\n          canvasAnnotationDisplay.toContext(context);\n        });\n      });\n    }\n\n    /** */\n  }, {\n    key: \"renderAnnotations\",\n    value: function renderAnnotations() {\n      var _this$props7 = this.props,\n        annotations = _this$props7.annotations,\n        drawAnnotations = _this$props7.drawAnnotations,\n        drawSearchAnnotations = _this$props7.drawSearchAnnotations,\n        searchAnnotations = _this$props7.searchAnnotations,\n        palette = _this$props7.palette;\n      if (drawSearchAnnotations) {\n        this.annotationsToContext(searchAnnotations, palette.search);\n      }\n      if (drawAnnotations) {\n        this.annotationsToContext(annotations, palette.annotations);\n      }\n    }\n\n    /**\n     * Renders things\n     */\n  }, {\n    key: \"render\",\n    value: function render() {\n      var viewer = this.props.viewer;\n      if (!viewer) return null;\n      return /*#__PURE__*/ReactDOM.createPortal( /*#__PURE__*/_jsx(\"div\", {\n        ref: this.ref,\n        style: {\n          height: '100%',\n          left: 0,\n          position: 'absolute',\n          top: 0,\n          width: '100%'\n        },\n        children: /*#__PURE__*/_jsx(\"canvas\", {})\n      }), viewer.canvas);\n    }\n  }], [{\n    key: \"annotationsMatch\",\n    value:\n    /**\n     * annotationsMatch - compares previous annotations to current to determine\n     * whether to add a new updateCanvas method to draw annotations\n     * @param  {Array} currentAnnotations\n     * @param  {Array} prevAnnotations\n     * @return {Boolean}\n     */\n    function annotationsMatch(currentAnnotations, prevAnnotations) {\n      if (!currentAnnotations && !prevAnnotations) return true;\n      if (currentAnnotations && !prevAnnotations || !currentAnnotations && prevAnnotations) return false;\n      if (currentAnnotations.length === 0 && prevAnnotations.length === 0) return true;\n      if (currentAnnotations.length !== prevAnnotations.length) return false;\n      return currentAnnotations.every(function (annotation, index) {\n        var newIds = annotation.resources.map(function (r) {\n          return r.id;\n        });\n        var prevIds = prevAnnotations[index].resources.map(function (r) {\n          return r.id;\n        });\n        if (newIds.length === 0 && prevIds.length === 0) return true;\n        if (newIds.length !== prevIds.length) return false;\n        if (annotation.id === prevAnnotations[index].id && isEqual(newIds, prevIds)) {\n          return true;\n        }\n        return false;\n      });\n    }\n  }]);\n  return AnnotationsOverlay;\n}(Component);\nAnnotationsOverlay.defaultProps = {\n  annotations: [],\n  deselectAnnotation: function deselectAnnotation() {},\n  drawAnnotations: true,\n  drawSearchAnnotations: true,\n  highlightAllAnnotations: false,\n  hoverAnnotation: function hoverAnnotation() {},\n  hoveredAnnotationIds: [],\n  palette: {},\n  searchAnnotations: [],\n  selectAnnotation: function selectAnnotation() {},\n  selectedAnnotationId: undefined,\n  viewer: null\n};","import { compose } from 'redux';\nimport { connect } from 'react-redux';\nimport { withTranslation } from 'react-i18next';\nimport { withPlugins } from '../extend/withPlugins';\nimport { AnnotationsOverlay } from '../components/AnnotationsOverlay';\nimport * as actions from '../state/actions';\nimport { getWindow, getSearchAnnotationsForWindow, getCompanionWindowsForContent, getTheme, getConfig, getPresentAnnotationsOnSelectedCanvases, getSelectedAnnotationId, getCurrentCanvasWorld } from '../state/selectors';\n\n/**\n * mapStateToProps - used to hook up connect to action creators\n * @memberof Window\n * @private\n */\nvar mapStateToProps = function mapStateToProps(state, _ref) {\n  var windowId = _ref.windowId;\n  return {\n    annotations: getPresentAnnotationsOnSelectedCanvases(state, {\n      windowId: windowId\n    }),\n    canvasWorld: getCurrentCanvasWorld(state, {\n      windowId: windowId\n    }),\n    drawAnnotations: getConfig(state).window.forceDrawAnnotations || getCompanionWindowsForContent(state, {\n      content: 'annotations',\n      windowId: windowId\n    }).length > 0,\n    drawSearchAnnotations: getConfig(state).window.forceDrawAnnotations || getCompanionWindowsForContent(state, {\n      content: 'search',\n      windowId: windowId\n    }).length > 0,\n    highlightAllAnnotations: getWindow(state, {\n      windowId: windowId\n    }).highlightAllAnnotations,\n    hoveredAnnotationIds: getWindow(state, {\n      windowId: windowId\n    }).hoveredAnnotationIds,\n    palette: getTheme(state).palette,\n    searchAnnotations: getSearchAnnotationsForWindow(state, {\n      windowId: windowId\n    }),\n    selectedAnnotationId: getSelectedAnnotationId(state, {\n      windowId: windowId\n    })\n  };\n};\n\n/**\n * mapDispatchToProps - used to hook up connect to action creators\n * @memberof ManifestListItem\n * @private\n */\nvar mapDispatchToProps = {\n  deselectAnnotation: actions.deselectAnnotation,\n  hoverAnnotation: actions.hoverAnnotation,\n  selectAnnotation: actions.selectAnnotation\n};\nvar enhance = compose(withTranslation(), connect(mapStateToProps, mapDispatchToProps), withPlugins('AnnotationsOverlay'));\nexport default enhance(AnnotationsOverlay);","export var OSDReferences = {\n  /** */get: function get(windowId) {\n    return this.refs[windowId];\n  },\n  refs: {},\n  /** */set: function set(windowId, ref) {\n    this.refs[windowId] = ref;\n  }\n};","function _construct(t, e, r) { if (_isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments); var o = [null]; o.push.apply(o, e); var p = new (t.bind.apply(t, o))(); return r && _setPrototypeOf(p, r.prototype), p; }\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == typeof i ? i : String(i); }\nfunction _toPrimitive(t, r) { if (\"object\" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != typeof i) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nfunction _callSuper(t, o, e) { return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e)); }\nfunction _possibleConstructorReturn(self, call) { if (call && (typeof call === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\nfunction _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\nimport { createRef, Children, cloneElement, Component } from 'react';\nimport { styled } from '@mui/material/styles';\nimport debounce from 'lodash/debounce';\nimport isEqual from 'lodash/isEqual';\nimport OpenSeadragon from 'openseadragon';\nimport classNames from 'classnames';\nimport ns from '../config/css-ns';\nimport AnnotationsOverlay from '../containers/AnnotationsOverlay';\nimport CanvasWorld from '../lib/CanvasWorld';\nimport { PluginHook } from './PluginHook';\nimport { OSDReferences } from '../plugins/OSDReferences';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar StyledSection = styled('section')({\n  cursor: 'grab',\n  flex: 1,\n  position: 'relative'\n});\n/**\n * Represents a OpenSeadragonViewer in the mirador workspace. Responsible for mounting\n * and rendering OSD.\n */\nexport var OpenSeadragonViewer = /*#__PURE__*/function (_Component) {\n  _inherits(OpenSeadragonViewer, _Component);\n  /**\n   * @param {Object} props\n   */\n  function OpenSeadragonViewer(props) {\n    var _this;\n    _classCallCheck(this, OpenSeadragonViewer);\n    _this = _callSuper(this, OpenSeadragonViewer, [props]);\n    _this.state = {\n      grabbing: false,\n      viewer: undefined\n    };\n    _this.ref = /*#__PURE__*/createRef();\n    _this.apiRef = /*#__PURE__*/createRef();\n    OSDReferences.set(props.windowId, _this.apiRef);\n    _this.onCanvasMouseMove = debounce(_this.onCanvasMouseMove.bind(_assertThisInitialized(_this)), 10);\n    _this.onViewportChange = _this.onViewportChange.bind(_assertThisInitialized(_this));\n    _this.zoomToWorld = _this.zoomToWorld.bind(_assertThisInitialized(_this));\n    _this.osdUpdating = false;\n    return _this;\n  }\n\n  /**\n   * React lifecycle event\n   */\n  _createClass(OpenSeadragonViewer, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n      var _this$props = this.props,\n        osdConfig = _this$props.osdConfig,\n        t = _this$props.t,\n        windowId = _this$props.windowId;\n      if (!this.ref.current) {\n        return;\n      }\n      var viewer = new OpenSeadragon(_objectSpread({\n        id: this.ref.current.id\n      }, osdConfig));\n      var canvas = viewer.canvas && viewer.canvas.firstElementChild;\n      if (canvas) {\n        canvas.setAttribute('role', 'img');\n        canvas.setAttribute('aria-label', t('digitizedView'));\n        canvas.setAttribute('aria-describedby', \"\".concat(windowId, \"-osd\"));\n      }\n      this.apiRef.current = viewer;\n      this.setState({\n        viewer: viewer\n      });\n      viewer.addHandler('canvas-drag', function () {\n        _this2.setState({\n          grabbing: true\n        });\n      });\n      viewer.addHandler('canvas-drag-end', function () {\n        _this2.setState({\n          grabbing: false\n        });\n      });\n\n      // Set a flag when OSD starts animating (so that viewer updates are not used)\n      viewer.addHandler('animation-start', function () {\n        _this2.osdUpdating = true;\n      });\n      viewer.addHandler('animation-finish', this.onViewportChange);\n      viewer.addHandler('animation-finish', function () {\n        _this2.osdUpdating = false;\n      });\n      if (viewer.innerTracker) {\n        viewer.innerTracker.moveHandler = this.onCanvasMouseMove;\n      }\n    }\n\n    /**\n     * When the tileSources change, make sure to close the OSD viewer.\n     * When the annotations change, reset the updateCanvas method to make sure\n     * they are added.\n     * When the viewport state changes, pan or zoom the OSD viewer as appropriate\n     */\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      var _this$props2 = this.props,\n        viewerConfig = _this$props2.viewerConfig,\n        canvasWorld = _this$props2.canvasWorld;\n      var viewer = this.state.viewer;\n      this.apiRef.current = viewer;\n      if (prevState.viewer === undefined) {\n        if (viewerConfig) {\n          viewer.viewport.panTo(viewerConfig, true);\n          viewer.viewport.zoomTo(viewerConfig.zoom, viewerConfig, true);\n          viewerConfig.degrees !== undefined && viewer.viewport.setRotation(viewerConfig.degrees);\n          viewerConfig.flip !== undefined && viewer.viewport.setFlip(viewerConfig.flip);\n        }\n        this.addAllImageSources(!viewerConfig);\n        return;\n      }\n      if (!this.infoResponsesMatch(prevProps.infoResponses) || !this.nonTiledImagedMatch(prevProps.nonTiledImages)) {\n        viewer.close();\n        var canvasesChanged = !isEqual(canvasWorld.canvasIds, prevProps.canvasWorld.canvasIds);\n        this.addAllImageSources(canvasesChanged || !viewerConfig);\n      } else if (!isEqual(canvasWorld.layers, prevProps.canvasWorld.layers)) {\n        this.refreshTileProperties();\n      } else if (viewerConfig && !this.osdUpdating) {\n        var viewport = viewer.viewport;\n        if (viewerConfig.x !== viewport.centerSpringX.target.value || viewerConfig.y !== viewport.centerSpringY.target.value) {\n          viewport.panTo(viewerConfig, false);\n        }\n        if (viewerConfig.zoom !== viewport.zoomSpring.target.value) {\n          viewport.zoomTo(viewerConfig.zoom, viewerConfig, false);\n        }\n        if (viewerConfig.rotation !== viewport.getRotation()) {\n          viewport.setRotation(viewerConfig.rotation);\n        }\n        if (viewerConfig.flip !== viewport.getFlip()) {\n          viewport.setFlip(viewerConfig.flip);\n        }\n      }\n    }\n\n    /**\n     */\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      var viewer = this.state.viewer;\n      if (viewer.innerTracker && viewer.innerTracker.moveHandler === this.onCanvasMouseMove) {\n        viewer.innerTracker.moveHandler = null;\n      }\n      viewer.removeAllHandlers();\n      this.onCanvasMouseMove.cancel();\n      this.apiRef.current = undefined;\n    }\n\n    /** Shim to provide a mouse-move event coming from the viewer */\n  }, {\n    key: \"onCanvasMouseMove\",\n    value: function onCanvasMouseMove(event) {\n      var viewer = this.state.viewer;\n      viewer.raiseEvent('mouse-move', event);\n    }\n\n    /**\n     * Forward OSD state to redux\n     */\n  }, {\n    key: \"onViewportChange\",\n    value: function onViewportChange(event) {\n      var _this$props3 = this.props,\n        updateViewport = _this$props3.updateViewport,\n        windowId = _this$props3.windowId;\n      var viewport = event.eventSource.viewport;\n      updateViewport(windowId, {\n        flip: viewport.getFlip(),\n        rotation: viewport.getRotation(),\n        x: Math.round(viewport.centerSpringX.target.value),\n        y: Math.round(viewport.centerSpringY.target.value),\n        zoom: viewport.zoomSpring.target.value\n      });\n    }\n\n    /** */\n  }, {\n    key: \"addAllImageSources\",\n    value: function addAllImageSources() {\n      var _this3 = this;\n      var zoomAfterAdd = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n      var _this$props4 = this.props,\n        nonTiledImages = _this$props4.nonTiledImages,\n        infoResponses = _this$props4.infoResponses;\n      return Promise.allSettled([].concat(_toConsumableArray(infoResponses.map(function (infoResponse) {\n        return _this3.addTileSource(infoResponse);\n      })), _toConsumableArray(nonTiledImages.map(function (image) {\n        return _this3.addNonTiledImage(image);\n      })))).then(function () {\n        if (infoResponses[0] || nonTiledImages[0]) {\n          if (zoomAfterAdd) _this3.zoomToWorld();\n          _this3.refreshTileProperties();\n        }\n      });\n    }\n\n    /** */\n  }, {\n    key: \"addNonTiledImage\",\n    value: function addNonTiledImage(contentResource) {\n      var canvasWorld = this.props.canvasWorld;\n      var viewer = this.state.viewer;\n      var type = contentResource.getProperty('type');\n      var format = contentResource.getProperty('format') || '';\n      if (!(type === 'Image' || type === 'dctypes:Image' || format.startsWith('image/'))) return Promise.resolve();\n      return new Promise(function (resolve, reject) {\n        resolve(viewer.addSimpleImage({\n          error: function error(event) {\n            return reject(event);\n          },\n          fitBounds: _construct(OpenSeadragon.Rect, _toConsumableArray(canvasWorld.contentResourceToWorldCoordinates(contentResource))),\n          index: canvasWorld.layerIndexOfImageResource(contentResource),\n          opacity: canvasWorld.layerOpacityOfImageResource(contentResource),\n          success: function success(event) {\n            return resolve(event);\n          },\n          url: contentResource.id\n        }));\n      });\n    }\n\n    /**\n     */\n  }, {\n    key: \"addTileSource\",\n    value: function addTileSource(infoResponse) {\n      var canvasWorld = this.props.canvasWorld;\n      var viewer = this.state.viewer;\n      return new Promise(function (resolve, reject) {\n        // OSD mutates this object, so we give it a shallow copy\n        var tileSource = _objectSpread({}, infoResponse.json);\n        var contentResource = canvasWorld.contentResource(infoResponse.id);\n        if (!contentResource) return;\n        viewer.addTiledImage({\n          error: function error(event) {\n            return reject(event);\n          },\n          fitBounds: _construct(OpenSeadragon.Rect, _toConsumableArray(canvasWorld.contentResourceToWorldCoordinates(contentResource))),\n          index: canvasWorld.layerIndexOfImageResource(contentResource),\n          opacity: canvasWorld.layerOpacityOfImageResource(contentResource),\n          success: function success(event) {\n            return resolve(event);\n          },\n          tileSource: tileSource\n        });\n      });\n    }\n\n    /** */\n  }, {\n    key: \"refreshTileProperties\",\n    value: function refreshTileProperties() {\n      var canvasWorld = this.props.canvasWorld;\n      var viewer = this.state.viewer;\n      var world = viewer.world;\n      var items = [];\n      for (var i = 0; i < world.getItemCount(); i += 1) {\n        items.push(world.getItemAt(i));\n      }\n      items.forEach(function (item, i) {\n        var contentResource = canvasWorld.contentResource(item.source['@id'] || item.source.id);\n        if (!contentResource) return;\n        var newIndex = canvasWorld.layerIndexOfImageResource(contentResource);\n        if (i !== newIndex) world.setItemIndex(item, newIndex);\n        item.setOpacity(canvasWorld.layerOpacityOfImageResource(contentResource));\n      });\n    }\n\n    /**\n     */\n  }, {\n    key: \"fitBounds\",\n    value: function fitBounds(x, y, w, h) {\n      var immediately = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : true;\n      var viewer = this.state.viewer;\n      viewer && viewer.viewport && viewer.viewport.fitBounds(new OpenSeadragon.Rect(x, y, w, h), immediately);\n    }\n\n    /**\n     * infoResponsesMatch - compares previous tileSources to current to determine\n     * whether a refresh of the OSD viewer is needed.\n     * @param  {Array} prevTileSources\n     * @return {Boolean}\n     */\n  }, {\n    key: \"infoResponsesMatch\",\n    value: function infoResponsesMatch(prevInfoResponses) {\n      var infoResponses = this.props.infoResponses;\n      if (infoResponses.length === 0 && prevInfoResponses.length === 0) return true;\n      if (infoResponses.length !== prevInfoResponses.length) return false;\n      return infoResponses.every(function (infoResponse, index) {\n        if (!prevInfoResponses[index]) {\n          return false;\n        }\n        if (!infoResponse.json || !prevInfoResponses[index].json) {\n          return false;\n        }\n        if (infoResponse.tokenServiceId !== prevInfoResponses[index].tokenServiceId) {\n          return false;\n        }\n        if (infoResponse.json['@id'] && infoResponse.json['@id'] === prevInfoResponses[index].json['@id']) {\n          return true;\n        }\n        if (infoResponse.json.id && infoResponse.json.id === prevInfoResponses[index].json.id) {\n          return true;\n        }\n        return false;\n      });\n    }\n\n    /**\n     * nonTiledImagedMatch - compares previous images to current to determin\n     * whether a refresh of the OSD viewer is needed\n     */\n  }, {\n    key: \"nonTiledImagedMatch\",\n    value: function nonTiledImagedMatch(prevNonTiledImages) {\n      var nonTiledImages = this.props.nonTiledImages;\n      if (nonTiledImages.length === 0 && prevNonTiledImages.length === 0) return true;\n      return nonTiledImages.some(function (image, index) {\n        if (!prevNonTiledImages[index]) {\n          return false;\n        }\n        if (image.id === prevNonTiledImages[index].id) {\n          return true;\n        }\n        return false;\n      });\n    }\n\n    /**\n     * zoomToWorld - zooms the viewer to the extent of the canvas world\n     */\n  }, {\n    key: \"zoomToWorld\",\n    value: function zoomToWorld() {\n      var immediately = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n      var canvasWorld = this.props.canvasWorld;\n      this.fitBounds.apply(this, _toConsumableArray(canvasWorld.worldBounds()).concat([immediately]));\n    }\n\n    /**\n     * Renders things\n     */\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n      var _this$props5 = this.props,\n        children = _this$props5.children,\n        label = _this$props5.label,\n        t = _this$props5.t,\n        windowId = _this$props5.windowId,\n        drawAnnotations = _this$props5.drawAnnotations;\n      var _this$state = this.state,\n        viewer = _this$state.viewer,\n        grabbing = _this$state.grabbing;\n      var enhancedChildren = Children.map(children, function (child) {\n        return /*#__PURE__*/cloneElement(child, {\n          zoomToWorld: _this4.zoomToWorld\n        });\n      });\n      return /*#__PURE__*/_jsxs(StyledSection, {\n        className: classNames(ns('osd-container')),\n        style: {\n          cursor: grabbing ? 'grabbing' : undefined\n        },\n        id: \"\".concat(windowId, \"-osd\"),\n        ref: this.ref,\n        \"aria-label\": t('item', {\n          label: label\n        }),\n        \"aria-live\": \"polite\",\n        children: [drawAnnotations && /*#__PURE__*/_jsx(AnnotationsOverlay, {\n          viewer: viewer,\n          windowId: windowId\n        }), enhancedChildren, /*#__PURE__*/_jsx(PluginHook, _objectSpread({\n          viewer: viewer\n        }, _objectSpread(_objectSpread({}, this.props), {}, {\n          children: null\n        })))]\n      });\n    }\n  }]);\n  return OpenSeadragonViewer;\n}(Component);\nOpenSeadragonViewer.defaultProps = {\n  children: null,\n  drawAnnotations: false,\n  infoResponses: [],\n  label: null,\n  nonTiledImages: [],\n  osdConfig: {},\n  viewerConfig: null\n};","import { compose } from 'redux';\nimport { connect } from 'react-redux';\nimport { withTranslation } from 'react-i18next';\nimport flatten from 'lodash/flatten';\nimport { withPlugins } from '../extend/withPlugins';\nimport { OpenSeadragonViewer } from '../components/OpenSeadragonViewer';\nimport * as actions from '../state/actions';\nimport { getVisibleCanvasNonTiledResources, getCurrentCanvas, getCanvasLabel, getViewer, getConfig, getCompanionWindowsForContent, selectInfoResponses, getCurrentCanvasWorld } from '../state/selectors';\n\n/**\n * mapStateToProps - used to hook up connect to action creators\n * @memberof Window\n * @private\n */\nvar mapStateToProps = function mapStateToProps(state, _ref) {\n  var windowId = _ref.windowId;\n  var canvasWorld = getCurrentCanvasWorld(state, {\n    windowId: windowId\n  });\n  var infoResponses = selectInfoResponses(state);\n  var imageServiceIds = flatten(canvasWorld.canvases.map(function (c) {\n    return c.imageServiceIds;\n  }));\n  return {\n    canvasWorld: canvasWorld,\n    drawAnnotations: getConfig(state).window.forceDrawAnnotations || getCompanionWindowsForContent(state, {\n      content: 'annotations',\n      windowId: windowId\n    }).length > 0 || getCompanionWindowsForContent(state, {\n      content: 'search',\n      windowId: windowId\n    }).length > 0,\n    infoResponses: imageServiceIds.map(function (id) {\n      return infoResponses[id];\n    }).filter(function (infoResponse) {\n      return infoResponse !== undefined && infoResponse.isFetching === false && infoResponse.error === undefined;\n    }),\n    label: getCanvasLabel(state, {\n      canvasId: (getCurrentCanvas(state, {\n        windowId: windowId\n      }) || {}).id,\n      windowId: windowId\n    }),\n    nonTiledImages: getVisibleCanvasNonTiledResources(state, {\n      windowId: windowId\n    }),\n    osdConfig: getConfig(state).osdConfig,\n    viewerConfig: getViewer(state, {\n      windowId: windowId\n    })\n  };\n};\n\n/**\n * mapDispatchToProps - used to hook up connect to action creators\n * @memberof ManifestListItem\n * @private\n */\nvar mapDispatchToProps = {\n  updateViewport: actions.updateViewport\n};\nvar enhance = compose(withTranslation(), connect(mapStateToProps, mapDispatchToProps), withPlugins('OpenSeadragonViewer'));\nexport default enhance(OpenSeadragonViewer);"],"names":["baseEach","isArrayLike","module","exports","collection","iteratee","index","result","Array","length","value","key","arrayMap","baseGet","baseIteratee","baseMap","baseSortBy","baseUnary","compareMultiple","identity","isArray","iteratees","orders","object","other","array","comparer","sort","baseDifference","baseFlatten","baseUniq","arrays","comparator","othIndex","isSymbol","valIsDefined","undefined","valIsNull","valIsReflexive","valIsSymbol","othIsDefined","othIsNull","othIsReflexive","othIsSymbol","compareAscending","objCriteria","criteria","othCriteria","ordersLength","eq","isIndex","isObject","type","baseOrderBy","baseRest","isIterateeCall","sortBy","arrayFilter","baseXor","isArrayLikeObject","xor","_defineProperties","target","props","i","descriptor","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","t","r","e","Symbol","toPrimitive","call","TypeError","String","Number","_toPrimitive","OpenSeadragonCanvasOverlay","viewer","ref","instance","Constructor","_classCallCheck","this","containerWidth","containerHeight","imgAspectRatio","protoProps","staticProps","get","canvasDiv","firstElementChild","current","canvas","getContext","context2d","clearRect","container","clientWidth","setAttribute","clientHeight","viewportOrigin","boundsRect","viewport","getBoundsNoRotateWithMargins","x","y","viewportWidth","width","viewportHeight","height","image1","world","getItemAt","imgWidth","source","dimensions","imgHeight","update","viewportZoom","getZoom","zoom","viewportToImageZoom","clearBeforeRedraw","clear","translate","scale","center","getCenter","getFlip","rotation","getRotation","rotate","Math","PI","setTransform","prototype","_toConsumableArray","arr","_arrayLikeToArray","_arrayWithoutHoles","iter","iterator","from","_iterableToArray","o","minLen","n","toString","slice","constructor","name","test","_unsupportedIterableToArray","_nonIterableSpread","len","arr2","CanvasAnnotationDisplay","_ref","resource","palette","zoomRatio","offset","selected","hovered","context","svgSelector","svgContext","fragmentSelector","fragmentContext","currentPalette","_this","globalAlpha","svgPaths","forEach","element","save","p","Path2D","attributes","d","nodeValue","strokeStyle","color","setLineDash","split","svgToCanvasMap","fill","stroke","keys","lineWidth","fillStyle","restore","_this$context","_this$context2","_this2","fragment","fillRect","apply","strokeRect","DOMParser","parseFromString","svgString","getElementsByTagName","ownKeys","getOwnPropertySymbols","filter","getOwnPropertyDescriptor","push","_objectSpread","arguments","_defineProperty","getOwnPropertyDescriptors","defineProperties","obj","_slicedToArray","_arrayWithHoles","l","u","a","f","next","done","_iterableToArrayLimit","_nonIterableRest","_callSuper","_getPrototypeOf","self","_assertThisInitialized","_possibleConstructorReturn","_isNativeReflectConstruct","Reflect","construct","Boolean","valueOf","setPrototypeOf","getPrototypeOf","bind","__proto__","ReferenceError","_setPrototypeOf","AnnotationsOverlay","_Component","createRef","osdCanvasOverlay","updateCanvas","onUpdateViewport","onCanvasClick","onCanvasMouseMove","onCanvasExit","subClass","superClass","create","_inherits","initializeViewer","prevProps","_this$props","drawAnnotations","drawSearchAnnotations","annotations","searchAnnotations","hoveredAnnotationIds","selectedAnnotationId","highlightAllAnnotations","annotationsUpdated","annotationsMatch","searchAnnotationsUpdated","hoveredAnnotationsUpdated","style","cursor","selectedAnnotationsUpdated","redrawAnnotations","canvasUpdateCallback","forceRedraw","cancel","removeHandler","event","canvasWorld","webPosition","position","point","eventSource","pointFromPixel","canvasAtPoint","_canvasWorld$canvasTo2","canvasToWorldCoordinates","id","canvasWidth","canvasHeight","annos","annotationsAtPoint","preventDefaultAction","toggleAnnotation","annosWithClickScore","radius","degreesToRadians","anno","score","degrees","cos","sin","isAnnotationAtPoint","annosWithScore","map","max","_this$props2","hoverAnnotation","windowId","_this$props3","addHandler","_this3","resize","canvasUpdate","renderAnnotations","_canvasWorld$canvasTo4","canvasX","canvasY","relativeX","relativeY","some","path","isPointInPath","_resource$fragmentSel","w","h","_this4","_this$props4","lists","concat","resources","targetId","_this$props5","selectAnnotation","deselectAnnotation","_this$props6","getMaxZoom","annotation","canvasIds","includes","offsetByCanvas","hidden","toContext","_this$props7","annotationsToContext","search","left","top","children","currentAnnotations","prevAnnotations","every","newIds","prevIds","Component","defaultProps","mapDispatchToProps","state","window","forceDrawAnnotations","content","withPlugins","OSDReferences","refs","set","_construct","StyledSection","styled","flex","OpenSeadragonViewer","grabbing","apiRef","onViewportChange","zoomToWorld","osdUpdating","osdConfig","setState","innerTracker","moveHandler","prevState","viewerConfig","panTo","zoomTo","setRotation","flip","setFlip","addAllImageSources","infoResponsesMatch","infoResponses","nonTiledImagedMatch","nonTiledImages","layers","centerSpringX","centerSpringY","zoomSpring","refreshTileProperties","close","canvasesChanged","removeAllHandlers","raiseEvent","updateViewport","round","zoomAfterAdd","Promise","allSettled","infoResponse","addTileSource","image","addNonTiledImage","then","contentResource","getProperty","format","startsWith","resolve","reject","addSimpleImage","error","fitBounds","contentResourceToWorldCoordinates","layerIndexOfImageResource","opacity","layerOpacityOfImageResource","success","url","tileSource","json","addTiledImage","items","getItemCount","item","newIndex","setItemIndex","setOpacity","immediately","prevInfoResponses","tokenServiceId","prevNonTiledImages","worldBounds","label","_this$state","enhancedChildren","Children","child","cloneElement","className","PluginHook","imageServiceIds","canvases","c","isFetching","canvasId"],"sourceRoot":""}